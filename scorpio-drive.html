<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>A-Frame 360 Video Play/Pause + Steering Sync</title>
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <style>
      /* Keeping the CSS style block as it was, though it's unused now. */
      .control-btn {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        padding: 12px 24px;
        background: rgba(0,0,0,0.6);
        color: white;
        font-size: 16px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <a-scene>
      <a-videosphere src="#video360" rotation="0 -90 0"></a-videosphere>

      <a-assets>
        <a-asset-item id="car" src="https://precious-quokka-a3803f.netlify.app/assets/scorpio without steering.glb"></a-asset-item>
        <a-asset-item id="steering" src="scorpio steering optimized.glb"></a-asset-item>
        <video id="video360" 
              src="road 360 trimmed.mp4"
              crossorigin="anonymous"
              playsinline
              webkit-playsinline
              preload="auto"
              muted>
        </video>
      </a-assets>

      <a-entity id="car" gltf-model="#car" position="0 0 0" scale="1 1 1">
          
        <a-entity id="camera" camera look-controls position="0.40632 1.27747 0.14709">
          <a-entity 
            cursor="fuse: true; fuseTimeout: 1500"
            raycaster="objects: .clickable"
            position="0 0 -0.5"
            geometry="primitive: ring; radiusInner: 0.015; radiusOuter: 0.025"
            material="color: #ffffff; shader: flat"
            animation__fusing="property: scale; startEvents: fusing; from: 1 1 1; to: 0.2 0.2 0.2; dur: 1500"
            animation__reset="property: scale; startEvents: mouseleave; to: 1 1 1; dur: 300">
          </a-entity>
        </a-entity>
        
        <a-entity id="steering" gltf-model="#steering" position="0.40557 1.02683 -0.49071" scale="1 1 1"
        animation__drive="property: rotation; to: -5 15 35; dur: 1000; easing: linear; dir: alternate; loop: true;
        >
        </a-entity>
        
        <a-plane id="playBtn" class="clickable" 
                 position="0.0192 1.05417 -0.57141" 
                 width="1.5" height="0.5" 
                 color="#2981f5" 
                 text="align: center; color: white; value: Start Drive; width: 5" 
                 scale="0.2 0.2 0.2">
        </a-plane>
        
      </a-entity>
    </a-scene>

    <script>
      const videoEl = document.querySelector('#video360');
      const btn = document.querySelector('#playBtn');
      const steering = document.querySelector('#steering');
      let isPlaying = false;

      // Define the steering animation properties
      const steeringAnimationProps = {
        property: 'rotation',
        to: '-5 15 35',
        dur: 1000,
        easing: 'linear',
        dir: 'alternate',
        loop: true
      };

      btn.addEventListener('click', async () => {
        if (!isPlaying) {
          // START DRIVE
          
          // 1. Start video (requires user gesture, hence the click)
          try {
            // Note: The video element needs to be unmuted for autoplay to work on some platforms.
            // Consider removing 'muted' from the video tag if you want sound, 
            // but keep it if you only want to bypass autoplay restrictions.
            await videoEl.play();
          } catch (e) {
            console.log("Video Play failed (might need user interaction):", e);
          }

          // 2. Start steering animation: Set the component to start the loop
          steering.setAttribute('animation__drive', steeringAnimationProps);

          // 3. Update state and button label
          btn.setAttribute('text', 'value: Stop Drive');
          isPlaying = true;

        } else {
          // STOP DRIVE
          
          // 1. Pause video
          videoEl.pause();

          // 2. Stop steering animation: Remove the component entirely
          steering.removeAttribute('animation__drive');

          // 3. Update state and button label
          btn.setAttribute('text', 'value: Start Drive');
          isPlaying = false;
        }
      });
    </script>
  </body>
</html>
