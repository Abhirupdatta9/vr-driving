<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>A-Frame 360 Video Play/Pause + Steering Sync (Fixed)</title>
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
  </head>
  <body>
    <a-scene>
      <a-videosphere src="#video360" rotation="0 -90 0"></a-videosphere>

      <a-assets>
        <a-asset-item id="car" src="https://precious-quokka-a3803f.netlify.app/assets/scorpio without steering.glb"></a-asset-item>
        <a-asset-item id="steering" src="scorpio steering optimized.glb"></a-asset-item>
        <video id="video360" 
               src="road 360 trimmed.mp4"
               crossorigin="anonymous"
               playsinline
               webkit-playsinline
               preload="auto"
               muted>
        </video>
      </a-assets>

      <a-entity id="car" gltf-model="#car" position="0 0 0" scale="1 1 1">
        <a-entity id="camera" camera look-controls position="0.40632 1.27747 0.14709">
          <a-entity 
            cursor="fuse: true; fuseTimeout: 1500"
            raycaster="objects: .clickable"
            position="0 0 -0.5"
            geometry="primitive: ring; radiusInner: 0.015; radiusOuter: 0.025"
            material="color: #ffffff; shader: flat">
          </a-entity>
        </a-entity>

        <!-- Steering wheel -->
        <a-entity id="steering" gltf-model="#steering" position="0.40557 1.02683 -0.49071" scale="1 1 1"></a-entity>
        
        <!-- Button -->
        <a-plane id="playBtn" class="clickable"
                 position="0.0192 1.05417 -0.57141"
                 width="1.5" height="0.5"
                 color="#2981f5"
                 text="align: center; color: white; value: Start Drive; width: 5"
                 scale="0.2 0.2 0.2">
        </a-plane>
      </a-entity>
    </a-scene>

    <script>
      const videoEl = document.querySelector('#video360');
      const btn = document.querySelector('#playBtn');
      const steering = document.querySelector('#steering');
      let isPlaying = false;
      let modelLoaded = false;

      // Define the animation
      const steeringAnimationProps = {
        property: 'rotation',
        to: '-5 15 35',
        dur: 1000,
        easing: 'linear',
        dir: 'alternate',
        loop: true
      };

      // Wait for steering model to be ready
      steering.addEventListener('model-loaded', () => {
        modelLoaded = true;
        console.log("âœ… Steering model loaded and ready");
      });

      btn.addEventListener('click', async () => {
        if (!isPlaying) {
          // --- START DRIVE ---
          try {
            await videoEl.play();
          } catch (e) {
            console.log("Video Play failed:", e);
          }

          if (modelLoaded) {
            steering.setAttribute('animation__drive', steeringAnimationProps);
          } else {
            console.warn("Steering model not yet loaded.");
          }

          btn.setAttribute('text', 'value: Stop Drive');
          isPlaying = true;

        } else {
          // --- STOP DRIVE ---
          videoEl.pause();

          // Stop steering and reset rotation
          steering.removeAttribute('animation__drive');
          steering.object3D.rotation.set(0, 0, 0);

          btn.setAttribute('text', 'value: Start Drive');
          isPlaying = false;
        }
      });
    </script>
  </body>
</html>
