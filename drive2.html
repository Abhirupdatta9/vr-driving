<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
  </head>
  <body>
    <script>
      // 1. Create a custom A-Frame component for controlling the car and camera.
      AFRAME.registerComponent('drivable', {
        init: function () {
          // Initialize speed and a flag to check if the car is moving.
          this.speed = 0.05;
          this.isMoving = false;
          
          // Get references to the car and camera entities.
          this.carEl = this.el;
          this.cameraRigEl = document.getElementById('camera-rig');

          // Find the "Start" button and add a click event listener.
          const startButton = document.getElementById('startButton');
          startButton.addEventListener('click', () => {
            this.isMoving = true;
          });
        },

        tick: function () {
          // 2. Check the 'isMoving' flag to start the movement logic.
          if (this.isMoving) {
            let carPosition = this.carEl.getAttribute('position');
            let cameraRigPosition = this.cameraRigEl.getAttribute('position');

            // Move the car forward along the Z-axis.
            carPosition.z -= this.speed;

            // Update the car's position.
            this.carEl.setAttribute('position', carPosition);

            // 3. Keep the camera synced with the car's new position.
            // Adjust the camera's Z position to move along with the car.
            cameraRigPosition.z = carPosition.z - 0.2; // A small offset for driver's POV.

            // Update the camera's position.
            this.cameraRigEl.setAttribute('position', cameraRigPosition);
          }
        }
      });
    </script>

    <a-scene>
      <a-assets>
        <a-asset-item id="roads" src="roads.glb"></a-asset-item>
        <a-asset-item id="car" src="astra sedan.glb"></a-asset-item>
      </a-assets>
      
      <a-sky src="hubble lawn.jpg" rotation="0 -130 0"></a-sky>

      <a-entity gltf-model="#roads" scale="2 2 2" position="0 -0.5 -5"></a-entity>
      
      <a-entity gltf-model="#car" id="car-entity" scale="0.5 0.5 0.5" position="0 -0.5 0" drivable></a-entity>

      <a-entity id="camera-rig" position="-0.19962 0.09534 -0.213">
        <a-camera position="0 0 0" look-controls="enabled: false;"></a-camera>
      </a-entity>

      <a-entity light="intensity: 10; penumbra: 1" position="0 0.09232 0"></a-entity>

      <a-entity
        geometry="primitive: box; height: 0.2; width: 0.5"
        material="color: #4CC3D9"
        position="0 1.5 -1"
        id="startButton"
        text="value: Start; align: center"
      ></a-entity>
      
    </a-scene>
  </body>
</html>
