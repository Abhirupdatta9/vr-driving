<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>A-Frame 360 Video</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    
    <script>
        // AFRAME.registerComponent('play-on-click', {
        //     init: function () {
        //         var el = this.el;
        //         var video = document.querySelector('#my-360-video');

        //         el.addEventListener('click', function () {
        //             // Start video playback
        //             video.play();
        //             // Hide the overlay
        //             el.setAttribute('visible', false);
        //         });
        //     }
        // });

    //     AFRAME.registerComponent('play-on-click', {
    //     init: function () {
    //         var el = this.el;
    //         var video = document.querySelector('#my-360-video');

    //         // 1. Listen for 'click' for desktop/raycaster
    //         el.addEventListener('click', function () {
    //             video.play();
    //             el.setAttribute('visible', false);
    //         });

    //         // 2. Listen for 'touchend' for reliable mobile interaction
    //         el.addEventListener('touchend', function (evt) {
    //             // Prevent the default touch action to ensure the event fires
    //             evt.preventDefault(); 
                
    //             // Only proceed if the video is currently paused/stopped
    //             if (video.paused) {
    //                 video.play();
    //                 el.setAttribute('visible', false);
    //             }
    //         });
            
    //         // OPTIONAL: Fallback listener on the window/document for maximum compatibility
    //         // This ensures any tap plays the video and hides the overlay, if the video is paused
    //         document.addEventListener('touchend', function (evt) {
    //             if (video.paused && document.querySelector('#play-overlay').getAttribute('visible')) {
    //                 video.play();
    //                 document.querySelector('#play-overlay').setAttribute('visible', false);
    //             }
    //         });
    //     }
    // });

        AFRAME.registerComponent('play-on-click', {
        init: function () {
            var el = this.el;
            var video = document.querySelector('#my-360-video');

            // Function to start the video and hide the overlay
            function startVideo() {
                // Only attempt to play if it's currently paused
                if (video.paused) {
                    video.play();
                    el.setAttribute('visible', false);
                }
            }

            // 1. Desktop Browser (reliable 'click' event)
            el.addEventListener('click', startVideo);

            // 2. Mobile Browser (more reliable 'touchend' event fired on the element)
            el.addEventListener('touchend', function(evt) {
                // Prevent default behavior (like scrolling or camera drag) if the touch hits the plane
                evt.preventDefault();
                evt.stopPropagation();
                
                // Use a short timeout to ensure the A-Frame raycaster has completed its work, 
                // which helps guarantee the video element is ready for play()
                setTimeout(startVideo, 50); 
            });
            
            // Optional: Listen for the A-Frame 'fused' event (cursor hover/dwell)
            // This is useful if the user is using gaze controls (VR headset or phone in Cardboard)
            el.addEventListener('fused', startVideo);
        }
    });
        
    </script>

    <style>
        /* Hide text on A-Frame inspector and prevent mobile scrolling */
        body {
            overflow: hidden;
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>

    <a-scene>
        <a-assets>
            <video 
                id="my-360-video" 
                src="https://precious-quokka-a3803f.netlify.app/assets/roads.mp4" 
                loop 
                playsinline 
                muted 
                crossorigin="anonymous"
                preload="auto"
            ></video>
        </a-assets>

        <a-videosphere src="#my-360-video"></a-videosphere>

        <a-entity camera look-controls>
            <a-cursor color="white" raycaster="objects: #play-overlay;"></a-cursor>
            
            <a-plane
                id="play-overlay"
                position="0 0 -1"
                width="1.5"
                height="0.5"
                color="#000000"
                opacity="0.8"
                play-on-click
                text="value: TAP TO BEGIN; align: center; color: white; wrap-count: 20; font: roboto"
            ></a-plane>
        </a-entity>
    </a-scene>

</body>
</html>
